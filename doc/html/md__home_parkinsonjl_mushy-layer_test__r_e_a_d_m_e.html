<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Mushy Layer: Testing</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Mushy Layer
   &#160;<span id="projectnumber">1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Testing </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Introduction</h1>
<p>This directory contains python scripts for running various test problems which demonstrate the accuracy of the code.</p>
<h1>Setup</h1>
<p>These tests require the code in <code>mushy-layer/execSubcycle/</code> and <code>mushy-layer/setupNewRun/</code> to be built.</p>
<p>Before running the test problems, you must first specify a directory to save the output to. This is done by the <code>getBaseOutputDir()</code> function in <code>mushyLayerRunUtils.py</code>. You should also add the directory (<code>/path/to/mushy-layer/test/</code>) to your PYTHONPATH.</p>
<p>Some of the error calculation is done using the Chombo compare utility located in <code>/path/to/chombo/lib/util/chomboCompare</code>. Make sure you have compiled this program, and make sure you have defined the environmental variable <code>CHOMBO_HOME=/path/to/chombo/</code>.</p>
<p>Analysis of the output is done via matlab scripts located in <code>/mushy-layer/matlab/</code>. You should add this directory to your matlab path via your <code>startup.m</code> file in order to run the analysis, e.g. </p><div class="fragment"><div class="line">addpath(genpath([&#39;~/mushy-layer/matlab/&#39;]))</div></div><!-- fragment --><p>The python scripts assume that the slurm job queuing system is accessible. If it is not, you will have to run the batch files which it creates manually. Alternatively, open up the <code>test/BatchJob.py</code> file and edit the <code>BatchJob.write_slurm_file(...)</code> and <code>BatchJob.run_task(...)</code> methods so that they work with your setup.</p>
<h1>Running the problems</h1>
<p>There are five test problems, which can each be run individually by </p><div class="fragment"><div class="line">$ python filename.py [options]</div></div><!-- fragment --><ul>
<li>testDiffusiveSolidification.py</li>
<li>testUniformPorousConvection.py</li>
<li>testFixedPorousHole.py</li>
<li>testPorousMushyHole.py</li>
<li>testFixedChillHeleShaw.py</li>
</ul>
<p>See the individual files for the options available.</p>
<p>Alternatively you may run all five test problems via</p>
<div class="fragment"><div class="line">$ python runMethodPaperTests.py</div></div><!-- fragment --><p>There are a lot of individual simulations that need to be run. It is highly recommended that you do this on a machine with lots of cores available so that you can the simulations on different cores in parallel, in which case most jobs should finish in a few hours. The Nusselt number tests with large Rayleigh number on high resolution grids require longer (&gt; 1 day).</p>
<p>The python scripts will create the relevant folders to hold the output, setup the parameter input files, submit jobs to run the simulations to the slurm queueing system, and also submit a job to run the relevant analysis code once all the jobs have finished. The output from analysis can be found in the sbatch.out file, so a typical directory structure might end up looking like</p>
<div class="fragment"><div class="line">/baseOutputDir (specified by the user)</div><div class="line">  /NoFlow</div><div class="line">    runAnalysis.sh</div><div class="line">    sbatch.out - output from the analysis</div><div class="line">    Various folders containing different simulations, each containing:</div><div class="line">      run.sh</div><div class="line">      pout.0</div><div class="line">      time.table.0</div><div class="line">      pltfiles.hdf5</div><div class="line">      chkfile.hdf5</div><div class="line">  /FixedPorousHole</div><div class="line">    ... same as above</div></div><!-- fragment --><h1>Figures and analysis</h1>
<p>Having run the test problems, most of the figures should already be created, usually in the same directory as the data for each test problem resides in. You can (re)generate the figures used in the Methods paper using </p><div class="fragment"><div class="line">$ python makeFigures.py</div></div><!-- fragment --><p> Use the matlab script <code>compileNuV2(base_dir)</code> to compile all the nusselt numbers, e.g. </p><div class="fragment"><div class="line">&gt;&gt;compileNuV2(&#39;/path/to/TestDir/ConvectionDB-CFL0.1&#39;)</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Aug 16 2019 21:11:36 for Mushy Layer by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
