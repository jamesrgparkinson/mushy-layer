<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Mushy Layer: Running the Mushy Layer code</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Mushy Layer
   &#160;<span id="projectnumber">1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Running the Mushy Layer code </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Introduction</h1>
<p>This document explains how to use the mushy layer code for various physical applications.</p>
<p>It assumes you already have a compiled version of the code which you can run.</p>
<h1>Basics</h1>
<p>There are over a hundred options used in the code, which are stored on the <code><a class="el" href="class_a_m_r_level_mushy_layer.html" title="AMRLevel for mushy layer calculations. ">AMRLevelMushyLayer</a></code> class in one of two places:</p>
<ol type="1">
<li>The member variable <code><a class="el" href="class_a_m_r_level_mushy_layer.html#abe361484bd04d3be84f4c3a0c96d896d" title="Physical parameters. ">AMRLevelMushyLayer.m_parameters</a></code> which is a <code><a class="el" href="class_mushy_layer_params.html" title="Class to handle the physical parameters of a mushy layer simulation. ">MushyLayerParams</a></code> object. This is where most physical parameters (e.g. Rayleigh number, Lewis number) are stored.</li>
<li>The member variable <code><a class="el" href="class_a_m_r_level_mushy_layer.html#a3652e6785ac8c5e429a5ac286ea3bc2e" title="Struct to contain all the options for this simulation. ">AMRLevelMushyLayer.m_opt</a></code>, which is a struct of type <code><a class="el" href="struct_mushy_layer_options.html" title="Contains most of the options for running the code, and how to handle the equations. ">MushyLayerOptions</a></code> and contains options on how to solve the equations (e.g. solver thresholds, how to do projection, and lots of debugging options).</li>
</ol>
<p>Inputs are loaded in the code via the <code><a class="elRef" doxygen="/home/parkinsonjl/chombofork/lib/chombo.tag:http://davis.lbl.gov/Manuals/CHOMBO-RELEASE-3.2//" href="http://davis.lbl.gov/Manuals/CHOMBO-RELEASE-3.2/classParmParse.html">ParmParse</a></code> class, e.g.</p>
<p>```cpp Real multigrid_threshold = 1e-10; <a class="elRef" doxygen="/home/parkinsonjl/chombofork/lib/chombo.tag:http://davis.lbl.gov/Manuals/CHOMBO-RELEASE-3.2//" href="http://davis.lbl.gov/Manuals/CHOMBO-RELEASE-3.2/classParmParse.html">ParmParse</a> pp("main"); pp.query("mg_thresh", multigrid_threshold) ``` which would load some inputs like ``` main.mg_thresh=1e-15 ```</p>
<p>We do most of this in either <code>/mushy-layer/srcSubcycle/MushyLayerSubcycleUtils.cpp</code> or <code>/mushy-layer/src/MushyLayerParams.cpp</code>.</p>
<p>Most of these options/parameters can just be left at their default values. The inputs file at <code>/mushy-layer/examples/meltponds/inputsGrowSeaIce</code> illustrates the main options you may wish to change, which are described in more detail below under some roughly suitable headings.</p>
<h1>General options</h1>
<p><code>main.verbosity=2</code> larger verbosity means there will be more text output produced</p>
<p><code>main.output_folder=.</code> folder to save plot/checkpoint files to a period <code>.</code> means the directory from which the code was executed</p>
<p><code>main.plot_prefix=plt</code> prefix for plot files, which will then be like <code>plt001234.2d.hdf5</code></p>
<p><code>main.chk_prefix=chk</code> prefix for checkpoint files</p>
<p><code>main.plot_interval=n</code> produce plot files every <code>n</code> steps (-1 = don't use this option)</p>
<p><code>main.checkpoint_interval=n</code> produce checkpoints files every <code>n</code> steps</p>
<p><code>main.plot_period=0.005</code> time interval at which to write out plot files</p>
<p><code>main.debug=false</code> set to true to write more fields to the plot files</p>
<h1>Timestepping</h1>
<p><code>main.cfl=0.1</code> max allowed CFL number</p>
<p><code>main.initial_cfl=2e-05</code> start simulations with a smaller CFL number. The timestep increases thereafter as determined by <code>main.max_dt_growth</code></p>
<p><code>main.max_dt=0.1</code> max allowed timestep</p>
<p><code>main.max_dt_growth=1.05</code> max fractional increase in $ t$ allowed from one timestep to the next</p>
<p><code>main.max_step=10000</code> stop simulations after this many timesteps</p>
<p><code>main.max_time=10.0</code> stop simulations once this time has been reached</p>
<p><code>main.min_time=0.1</code> ensure simulations run until at least this time (even if a steady state condition is reached)</p>
<p><code>main.dt_tolerance_factor=1.01</code> Set the factor by which the current dt must exceed the new (max) dt for time subcycling to occur (i.e., reduction of the current dt by powers of 2).</p>
<h1>Domain setup</h1>
<p><code>main.num_cells=Nx Ny Nz</code> e.g. <code>main.num_cells=64 128</code> size of the grid on the coarsest mesh. Make sure each dimensions is a power of 2 unless you want the multigrid to be slow. Only need to specify 2 dimensions if the code is compiled for 2 dimensions. The final dimension is always the 'vertical' with respect to gravity.</p>
<p><code>main.domain_height=1.0</code> domain height (width is then calculated from the number of grid cells specified)</p>
<p><code>main.periodic_bc=1 0</code> whether to enforce periodic boundaries (1) or not (0) in each dimension</p>
<p><code>main.max_grid_size=256</code> split domain into boxes (for sending to different processors) of max size in any dimension given by this parameter.</p>
<h1>Boundary conditions</h1>
<p>Boundary conditions are defined in two ways. Firstly we define the type of boundary condition to apply to each side, then we define the value to use (where needed) at each side. For scalars, options are:</p>
<p>0. Dirichlet</p>
<ol type="1">
<li>Neumann</li>
<li>Inflow/outflow</li>
</ol>
<p>For vectors, there are lots of options, some of the most important being</p>
<p>0. Solid wall</p>
<ol type="1">
<li>Inflow/outflow</li>
<li>Reflection</li>
<li>Pressure head</li>
</ol>
<p>See BCUtil/PhysBCUtil.h for a full list of possible options.</p>
<p>We set boundary conditions on the 'high' side of the domain in each dimension, then the 'low' side of the domain in each dimension e.g.</p>
<p><code>bc.scalarHi=1 0</code> scalar BCs are neumann on the right boundary, dirichlet on the top</p>
<p><code>bc.scalarLo=1 2</code> scalar BCs are neumann on the left boundary, inflow/outflow at the bottom</p>
<p><code>bc.velHi=6 0</code></p>
<p><code>bc.velLo=6 3</code></p>
<p>We then specify the values of the bulk concentration and enthalpy on each boundary in a similar way</p>
<p><code>bc.bulkConcentrationHiVal=-1 -1</code></p>
<p><code>bc.bulkConcentrationLoVal=-1 -1</code></p>
<p><code>bc.enthalpyHiVal=0 0.9</code></p>
<p><code>bc.enthalpyLoVal=0.0 6.03</code></p>
<p>Boundary values for temperature, porosity, liquid salinity etc. are computed from the specified bulk concentration and enthalpy. If needed, they can be provided explicitly using e.g ``` bc.temperatureLo bc.porosityLo bc.liquidConcentrationLo permeabilityLo ```</p>
<h1>Dimensionless parameters</h1>
<p><code>main.nondimensionalisation=0</code> choose nondimensionalisation, different options are: 0. Diffusive timescale, advective velocity scale</p>
<ol type="1">
<li>Darcy timescales, advective velocity scale</li>
<li>Darcy timescale, darcy velocity scale</li>
<li>Advective timescale, darcy velocity scale</li>
<li>Buoyancy timescale, advective velocity scale</li>
</ol>
<p><code>parameters.problem_type=0</code> can specify different problem types, which can tell the code to solve some of the equations differently. Lots of the options aren't really used anymore (and maybe don't work). Ones which definitely should work are in bold. 0. <em>mushyLayer</em></p>
<ol type="1">
<li>burgers equation</li>
<li>burgers equation on a periodic domain</li>
<li>poiseuille flow</li>
<li>diffusion</li>
<li><em>solidificationNoFlow</em></li>
<li>corner flow</li>
<li>sidewall heating</li>
<li>vertical heating (with Darcy's equation)</li>
<li>rayleigh-benard (navier-stokes)</li>
<li>a solute flux test</li>
<li>a reflux test</li>
<li>a test for solving with zero porosity</li>
<li>simulating a melting ice block</li>
<li><em>convectionMixedPorous</em></li>
<li>vortex pair (navier-stokes benchmark problem)</li>
</ol>
<p><code>parameters.compositionRatio=1.18</code> composition ratio, should be &gt;= 1.0.</p>
<p><code>parameters.rayleighComp=500</code> rayleigh number for compositional differences. When just solving Darcy's equation, this is the mushy layer number. Otherwise, it's the fluid rayleigh number.</p>
<p><code>arameters.rayleighTemp=25.0</code> rayleigh number for temperature.</p>
<p><code>parameters.stefan=5.0</code> stefan number</p>
<p><code>parameters.K=1</code> ratio of solid/liquid heat diffusivity</p>
<p><code>parameters.heatConductivityRatio=1</code> ratio of solid/liquid heat conductivity</p>
<p><code>parameters.specificHeatRatio=1</code> ratio of solid.liquid specific heat</p>
<p><code>parameters.lewis=100</code> lewis number (liquid heat diffusivity/liquid salt diffusivity)</p>
<p><code>parameters.darcy=0.0</code> darcy number. Set to 0 to solve Darcy's equation rather than Darcy-Brinkman</p>
<p><code>parameters.prandtl=0</code> prandtl number</p>
<p><code>parameters.heleShaw=true</code> constrain permeabilities by a Hele-Shaw cell</p>
<p><code>parameters.nonDimReluctance=0.1</code> inverse of the dimensionless Hele-Shaw permeabilty. Smaller means wider hele-shaw gap width.</p>
<p><code>parameters.nonDimVel=0.0</code> (dimensionless) frame advection velocity <code>parameters.permeabilityFunction=2</code> mathematical form of the permeability function. Options include: 0. pureFluid (permeability=1)</p>
<ol type="1">
<li>cubic (permeability=porosity^3)</li>
<li>kozeny-carman (permeability = porosity^3 / (1-porosity)^2</li>
<li>log function (permeability = - porosity^2 * log(1-porosity) )</li>
<li>spatially dependent permeability with a channel</li>
<li>permeability = porosity</li>
</ol>
<p><code>parameters.waterDistributionCoeff=1e-5</code> water distribution coefficient</p>
<h2>Phase diagram</h2>
<p><code>parameters.eutecticComposition=230</code></p>
<p><code>parameters.eutecticTemp=-23</code></p>
<p><code>parameters.initialComposition=30</code></p>
<p><code>parameters.liquidusSlope=-0.1</code></p>
<h1><a class="elRef" doxygen="/home/parkinsonjl/chombofork/lib/chombo.tag:http://davis.lbl.gov/Manuals/CHOMBO-RELEASE-3.2//" href="http://davis.lbl.gov/Manuals/CHOMBO-RELEASE-3.2/classAMR.html">AMR</a> options</h1>
<p><code>main.max_level=0</code> max allowed level for <a class="elRef" doxygen="/home/parkinsonjl/chombofork/lib/chombo.tag:http://davis.lbl.gov/Manuals/CHOMBO-RELEASE-3.2//" href="http://davis.lbl.gov/Manuals/CHOMBO-RELEASE-3.2/classAMR.html">AMR</a> simulations.</p>
<p><code>main.block_factor=8</code> all boxes must be divisible by at least this length in all dimensions.</p>
<p><code>main.use_subcycling=1</code> whether or not to use subcycling in time</p>
<p><code>main.ref_ratio=2 2 2</code> refinement ratios between successive levels</p>
<p><code>main.refine_thresh=0.1</code> refinement threshold</p>
<p><code>main.regrid_interval=8 8 8</code> regrid interval on each level</p>
<p><code>main.tag_buffer_size=4</code> number of cells by which to grow the set of cells tagged for refinement, before creating the new grids</p>
<p><code>main.fill_ratio=0.75</code> should be between 0 and 1. A value of 1 means the grids generated on refined levels will be as tightly grouped as possible to the cells tagged for refinement. A smaller value means that Chombo will cover a larger area on refined levels with grid cells.</p>
<p><code>main.grid_buffer_size=0 0 0</code> this is the 'padding' between grids on different levels of refinement</p>
<p><code>projection.eta=0.0</code> Freestream correction coefficient. Should be less than 1 for stability, but close to 1 for accuracy. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Mar 19 2019 19:25:23 for Mushy Layer by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
