# Middleton (1997)
# Assuming length scale of 10cm
# Tank depth 37.6cm
# Tank width 20cm (both directions, not hele shaw)
# Initial salinity 1 to 14 wt% = 10 to 140 g/kg
# Top temperature = -10 to -20 degrees C
# Initial temperature = -2 degrees C
# Brine channels around 1mm, so need resolution around 0.25 mm. Therefore Nx = 20cm/0.25mm = 800 - choose 1024 wide.
# Initially use darcy flow

amrmultigrid.MGtype=1
amrmultigrid.hang_eps=1.0e-10
amrmultigrid.max_iter=10
amrmultigrid.norm_thresh=1.0e-10
amrmultigrid.num_mg=1
amrmultigrid.num_smooth=8
amrmultigrid.relaxMode=1
amrmultigrid.tolerance=1.0e-10
amrmultigrid.verbosity=0
bc.scalarHi=1 0
bc.scalarLo=1 2 # outflow bottom
bc.enthalpyHiVal=0 0.9
bc.enthalpyLoVal=0 6.05

#parameters.topBulkConc=-1.0
#parameters.topEnthalpy=0.9
#parameters.bottomEnthalpy=6.05

bc.bulkConcentrationHiVal = 0 -1.0
bc.bulkConcentrationLoVal = 0 -1.0

bc.velHi=6 0
bc.velLo=6 3 # outflow bottom
machineCodeIsRunOn=atmnode011
main.addSubtractGradP=1
main.block_factor=1
main.cfl=0.8
main.checkpoint_interval=100
main.chk_prefix=chk
main.doEuler=0
main.doProjection=1
main.doVCreflux=0

main.dt_tolerance_factor=1.01
main.enforceAnalyticSoln=false
main.fill_ratio=0.75
main.grid_buffer_size=1
main.ignoreSolverFails=false
main.initialPerturbation=0.0
main.initial_cfl=0.01
main.initialize_pressure=true
main.iter_plot_interval=-1
main.iteration_plot_interval=-1
main.maxRestartWavenumber=1
main.max_dt=1e-2
main.max_dt_growth=1.1
main.max_grid_size=64
main.max_level=0
main.max_step=1000
main.max_time=100.0
main.min_time=1.0

main.num_cells=32 32 #1024 1536 64
main.domain_width=0.2

main.output_folder=/home/parkinsonjl/convection-in-sea-ice/MushyLayer/execSubcycle/outputMiddleton
main.periodic_bc=0 0 1
main.plot_interval=50
main.plot_prefix=plt
main.project_initial_vel=true
main.ref_ratio=2 2 2
main.refine_thresh=0.04
main.refluxType=2
main.regrid_interval=8 8 4
main.restart_newTime=0.0
main.restart_perturbation=0.0
main.restart_wavenumber=1
main.scalePwithChi=1
main.solverFailRestartMethod=0
main.steady_state=1e-10
main.symmetric_domain=false
main.tag_buffer_size=2
main.time_integration_order=1
main.use_limiting=true
main.use_subcycling=0
main.verbosity=2
main.viscous_solver_tol=1e-15
mercurialRepository=909+
parameters.K=1
parameters.bottomBulkConc=-1.0

parameters.compositionRatio=1.18
parameters.darcy=0.0
parameters.eutecticComposition=230
parameters.eutecticTemp=-23
parameters.heatConductivityRatio=1
parameters.heleShaw=true
parameters.initialComposition=35
parameters.lewis=200
parameters.liquidusSlope=-0.1
parameters.nonDimReluctance=0.1 #0.0133
parameters.nonDimVel=0.0
parameters.permeabilityFunction=2
parameters.prandtl=0.0
parameters.problem_type=0
parameters.rayleighComp=1000 #500.0
parameters.rayleighTemp=100.0
parameters.specificHeatRatio=1
parameters.stefan=5.0
parameters.waterDistributionCoeff=1e-5
picardSolver.max_iter=8
picardSolver.tol=1e-5
projection.eta=0.0
projection.numSmoothDown=16
projection.numSmoothUp=16
projection.solverTol=1e-15
projector.verbosity=0

parameters.nonDimReluctance=0.01 #0.0133
#main.periodic_bc=1 0 1
main.domain_width=0.02
main.initial_cfl=1e-3
main.max_dt_growth=1.01
main.num_cells=64 128

main.initial_cfl=1e-3
main.plot_interval=25
main.max_step=5000

main.time_integration_order=2 # need this (or very small init cfl)

# Now try and do darcy-brinkman
#parameters.darcy=1e-2
#parameters.prandtl=10.0
#main.doEuler=1
#parameters.rayleighComp=5e4
#parameters.rayleighTemp=0.0
#main.debug=true
#bc.velLo=6 0
#bc.scalarLo=1 0 # solid bottom
#bc.velLo=6 3
#bc.scalarLo=1 2 # solid bottom


#main.advectionMethod=2
#ccSrc.advection=0
##advSrc.viscous=0
#advSrc.darcy=0
#main.cfl=0.1

